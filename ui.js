function loadCustomizedKeyboard(e){if(0!==localStorage.length)for(var t=0;t<localStorage.length;t++){var o=localStorage.key(t);if("emoji"===o.split("_")[0]){var a=JSON.parse(localStorage.getItem(localStorage.key(t)));$("#"+e).prepend("<span class='emojiitemparent' emoji-data='"+a[0]+'\' data-clipboard-action="copy" data-clipboard-target="#txt"><span title=\''+a[1]+"' class='"+a[2]+"'></span></span>")}}}function addMultipleListener(e){$("#"+e).on("click",".emojiitemparent",function(e){if(e.altKey)$(this).remove(),saveRemovedKey(this);else{var t=$(this).attr("emoji-data");if(insertIt(t),$("#soundonoff").prop("checked"))try{sound.play()}catch(e){}}}),$("#"+e).on("mousedown",".emojiitemparent",function(e){$(this).css({"-webkit-transform":"scale(.9,.9)","-moz-transform":"scale(.9,.9)","-ms-transform":"scale(.9,.9)","-o-transform":"scale(.9,.9)",transform:"scale(.9,.9)"})}),$("#"+e).on("mouseup",".emojiitemparent",function(e){$(this).css({"-webkit-transform":"scale(1,1)","-moz-transform":"scale(1,1)","-ms-transform":"scale(1,1)","-o-transform":"scale(1,1)",transform:"scale(1,1)"})})}function findE(e){$("#searchpanel").html(""),$("#searchpanel").off("click"),$("#searchpanel").off("mousedown"),$("#searchpanel").off("mouseup"),searchEmoji(e),$(this).val("")}function searchEmoji(e){e=e.toLowerCase();var t=$(".emojiitemparent");t.each(function(){var t=$(this).attr("data-keywords");if(null==t&&(t="nullnullnull"),t.toLowerCase().indexOf(e)>=0){var o=$(this).clone();$("#searchpanel").append(o)}}),$("#searchpanel").on("click",".emojiitemparent",function(e){var t=$(this).attr("emoji-data");if(e.ctrlKey||e.metaKey){if(!checkExist(t,"favouritedata")){var o=$(this).clone();$("#favouritedata").append(o),saveAddedKey(this)}}else if(insertIt(t),$("#soundonoff").prop("checked"))try{sound.play()}catch(e){}}),$("#searchpanel").on("mousedown",".emojiitemparent",function(e){$(this).css({"-webkit-transform":"scale(.9,.9)","-moz-transform":"scale(.9,.9)","-ms-transform":"scale(.9,.9)","-o-transform":"scale(.9,.9)",transform:"scale(.9,.9)"})}),$("#searchpanel").on("mouseup",".emojiitemparent",function(e){$(this).css({"-webkit-transform":"scale(1,1)","-moz-transform":"scale(1,1)","-ms-transform":"scale(1,1)","-o-transform":"scale(1,1)",transform:"scale(1,1)"})})}function toggleCategory(e){$("#container #navbar #menu li").css("backgroundColor","white"),e.css("backgroundColor","cyan"),$("#container #content .subcontent").css("visibility","hidden"),$("#container #content .subcontent").css("display","none");var t=e.attr("class");$("#"+t).css("visibility","visible"),$("#"+t).css("display","block"),document.body.scrollTop=0,document.documentElement.scrollTop=0}function checkExist(e,t){var o=document.getElementById(t);if(o.childNodes.length<=0)return!1;for(var a=0;a<o.childNodes.length;a++)if(o.childNodes[a].getAttribute("emoji-data")===e)return!0;return!1}function addKeyEvent4Emoji(){for(var e=category.length-1;e>=0;e--)$("#"+category[e]+"data").on("click",".emojiitemparent",function(e){var t=$(this).attr("emoji-data");if(e.ctrlKey||e.metaKey){if(!checkExist(t,"favouritedata")){var o=$(this).clone();$("#favouritedata").append(o),saveAddedKey(this)}}else if(insertIt(t),$("#soundonoff").prop("checked"))try{sound.play()}catch(e){}}),$("#"+category[e]+"data").on("mousedown",".emojiitemparent",function(e){$(this).css({"-webkit-transform":"scale(.9,.9)","-moz-transform":"scale(.9,.9)","-ms-transform":"scale(.9,.9)","-o-transform":"scale(.9,.9)",transform:"scale(.9,.9)"})}),$("#"+category[e]+"data").on("mouseup",".emojiitemparent",function(e){$(this).css({"-webkit-transform":"scale(1,1)","-moz-transform":"scale(1,1)","-ms-transform":"scale(1,1)","-o-transform":"scale(1,1)",transform:"scale(1,1)"})})}function insertIt(e){$("#txt").prop("readonly",!0),currentPos=insertTextIntoPos("txt",e,currentPos),new Clipboard(".emojiitemparent").on("success",function(e){e.clearSelection()}),$("#btnclear").css("visibility","visible"),$("#txt").prop("readonly",!1),sendEmojiText($("#txt").val())}function sendEmojiText(e){var t=["toContentJS","set",e];chrome.tabs.query({currentWindow:!0,active:!0},function(e){chrome.tabs.sendMessage(e[0].id,t)}),objfirst=1}function getCursorPos(e){var t=document.getElementById(e);if(t){var o=(t.scrollTop,0),a=t.selectionStart||"0"==t.selectionStart?"ff":document.selection?"ie":!1;if("ie"==a){t.focus();var n=document.selection.createRange();n.moveStart("character",-t.value.length),o=n.text.length}else"ff"==a&&(o=t.selectionStart);return o}}function setCursorPos(e,t){var o=document.getElementById(e);if(o){var a=(o.scrollTop,o.selectionStart||"0"==o.selectionStart?"ff":document.selection?"ie":!1);if("ie"==a){o.focus();var n=document.selection.createRange();n.moveStart("character",-t)}else"ff"==a&&(o.selectionStart=t);o.focus()}}function insertTextIntoPos(e,t,o){setCursorPos(e,o);var a=document.getElementById(e);if(a){var n=a.value.substring(0,o),s=a.value.substring(o,a.value.length),r=a.selectionStart||"0"==a.selectionStart?"ff":document.selection?"ie":!1;if(a.value=n+t+s,o+=t.length,"ie"==r){a.focus();var c=document.selection.createRange();c.moveStart("character",-a.value.length),c.moveStart("character",o),c.moveEnd("character",0),c.select()}else"ff"==r&&(a.selectionStart=o,a.selectionEnd=o,a.focus());return o}}function getCookie(e){for(var t=document.cookie.split(";"),o=0;o<t.length;o++)if(t[o].indexOf(e)>=0)return t[o].split("=")[1];return"true"}function saveAddedKey(e){var t=[];t[0]=e.getAttribute("emoji-data"),t[1]=e.firstChild.getAttribute("title"),t[2]=e.firstChild.getAttribute("class"),localStorage.setItem("emoji_"+t[0],JSON.stringify(t))}function saveRemovedKey(e){var t=e.getAttribute("emoji-data");localStorage.removeItem("emoji_"+t)}$(document).ready(function(e){$("#content .default").css("visibility","visible"),$("#container #navbar #menu .symbols").css("backgroundColor","cyan"),$("#content .default").css("display","block"),$("#container #navbar #menu li").click(function(e){toggleCategory($(this))}),addMultipleListener("favouritedata"),loadCustomizedKeyboard("favouritedata");try{var t=chrome.extension.getBackgroundPage();"<br>"===String(t.glvars_inputtext).toLowerCase()&&(t.glvars_inputtext=""),t.glvars_inputtext=String(t.glvars_inputtext).replace("<br>","").replace("<br/>","").replace("<p>","").replace("</p>",""),$("#txt").val(t.glvars_inputtext==="undefined"?"":t.glvars_inputtext),currentPos=$("#txt").val().length,""!==t.glvars_inputtext&&$("#btnclear").css("visibility","visible")}catch(e){}var o=getCookie("soundonoff");"true"===o&&$("#soundonoff").click(),addKeyEvent4Emoji(),$("#btnclear").click(function(e){$("#txt").val(""),sendEmojiText("")}),$("#soundonoff").change(function(e){document.cookie="soundonoff="+$("#soundonoff").prop("checked")+"; expires=31 Dec 9999 12:00:00 UTC"}),$("#btcopy").click(function(e){new Clipboard(".btcopy").on("success",function(e){e.clearSelection()})}),$("#header input").mousedown(function(e){$(this).css("backgroundColor","white"),$(this).css("color","black")}),$("#header input").mouseup(function(e){$(this).css("backgroundColor","rgba(255,255,255,.17)"),$(this).css("color","rgba(255,255,255,.56)")}),$("#txt").keyup(function(e){27==e.keyCode&&$(this).val(""),sendEmojiText($("#txt").val()),currentPos=getCursorPos("txt")}),$("#txt").click(function(e){currentPos=getCursorPos("txt")}),$("#searchbox").keyup(function(e){13==e.keyCode&&(findE($(this).val()),$("#searchstatus").html('Result for keyword: <span style="color:red;">'+$(this).val()+"</span>"),$(this).val(""))}),$("body").keydown(function(e){(114===e.keyCode||(e.ctrlKey||e.metaKey)&&70===e.keyCode)&&(e.preventDefault(),$("#container #navbar #menu .search").click(),$("#searchbox").focus()),(e.ctrlKey||e.metaKey)&&67===e.keyCode&&(e.preventDefault(),$("#btcopy").click()),(e.ctrlKey||e.metaKey)&&68===e.keyCode&&(e.preventDefault(),$("#container #navbar #menu .favourite").click())});for(var a=1;6>=a;a++)$("#skintone").on("click","#sktone"+a,function(e){var t=$(this).attr("id").substr(6,1);$("#skintone span").css("border","1px solid transparent"),$(this).css("border","1px solid red"),findE("tone "+t),$("#searchstatus").html("&nbsp")});$("#tags .tagname").click(function(){findE($(this).attr("data-tag")),$("#tags .tagname").css("color","green"),$(this).css("color","red"),$("#searchstatus").html("")})});var currentPos=0,objfirst=0,category=["people","activity","nature","travel","food","regional","flags","objects","symbols"],sound=new Audio("quicks/sound.mp3");